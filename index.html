<script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
<script src="js/anime.min.js"></script>
<script>
  /* window.onload=function() {
    const b1 = document.getElementById("button1");
    b1.classList.remove("buttons");
    b1.classList.toggle("after-buttons");
    console.log(b1.style)
  }; */
   AFRAME.registerComponent("registerevents", {
    init: function () {
      let marker = this.el;
      const buttonUp = function () {
        const b1 = document.getElementById("button1");
        b1.classList.remove("buttons");
        b1.classList.toggle("after-buttons");
        const b2 = document.getElementById("button2");
        b2.classList.remove("buttons");
        b2.classList.toggle("after-buttons");
        const b3 = document.getElementById("button3");
        b3.classList.remove("buttons");
        b3.classList.toggle("after-buttons");
        console.log(b1);
      };
      const buttonDown = function () {
        const b1 = document.getElementById("button1");
        b1.classList.remove("after-buttons");
        b1.classList.toggle("buttons");
        const b2 = document.getElementById("button2");
        b2.classList.remove("after-buttons");
        b2.classList.toggle("buttons");
        const b3 = document.getElementById("button3");
        b3.classList.remove("after-buttons");
        b3.classList.toggle("buttons");
      };
      // マーカーを検出したイベントの登録
      marker.addEventListener("markerFound", function () {
        buttonUp();
      });

      // マーカーを見失ったイベントの登録
      marker.addEventListener("markerLost", function () {
        buttonDown();
      });
    },
  });
  
  
  function run(id) {
        console.log("#" + id);
        const mid = "#" + id;
        var entity = document.querySelector(mid);

        var test = {
          posX: 0,
          posY: 0,
        };

        anime({
          targets: test,
          posY: 0,
          posX: 180,
          elasticity: 10000,
          update: function () {
            entity.setAttribute("rotation", {
              x: test.posX,
              y: 0,
              z: 0,
            });
            /* alert('clicked'); */
          },
          direction: "alternate",
          delay: 268,
          loop: false,
        });
      }
      AFRAME.registerComponent("turn", {
        update: function () {
          this.el.addEventListener("click", function (evt) {
            run(this.id);
          });
        },
      });
      function button1event(){
        console.log("funcRun");
        run("sphere");
        console.log("funcEnd");
      }
      function button2event(){
        console.log("funcRun");
        run("bluebox");
        var effect = document.createElement('a-entity');
        effect.setAttribute('position', pointStr);
        effect.setAttribute('raycaster', 'enabled: false');
        effect.setAttribute('particle-system', 'color: #ff0, #ff9;maxParticleCount: 100;maxAge: ' + (particleAge / 1000) + ';velocityValue:0 -1 0; accelerationValue: 0 0.5 0; duration: 1;');
        effect.setAttribute('sound', 'src: #correct; autoplay: true');
        var scene = document.querySelector('a-scene');
        scene.appendChild(effect);
        console.log("funcEnd");
      }
      function button3event(){
        console.log("funcRun");
        run("redbox");
        console.log("funcEnd");
      }
      function quizstart(){
        const b1 = document.getElementById("quizstart");
        b1.classList.remove("start");
        b1.classList.toggle("after-start");
      }
</script>
<style>
  .start {
    height: 100%;
    width: 100%;
    position: absolute;
    top: 0;
    left: 0;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .after-start {
    text-align: center;
    font-size: 1em;
    color: transparent;
    z-index: -9999;
  }
  .after-click {
    text-align: center;
    font-size: 1.25em;
    color: transparent;
  }
  /* .loader{
    z-index: 9999;;
    position: absolute;
  } */
  .buttons{
    color: white;
    position: absolute;
    height: 80px;
    width: 120px;
    z-index: -9999;
    bottom: 0px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .startbutton{
    color: white;
    position: absolute;
    height: 80px;
    width: 120px;
    z-index: -9999;
    bottom: 0px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .after-startbutton{
    color: white;
    position: absolute;
    height: 80px;
    width: 120px;
    z-index: -9999;
    bottom: 0px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #button1{
    left: 0;
  }
  .after-buttons{
    color: white;
    position: absolute;
    height: 80px;
    width: 120px;
    z-index: 9999;
    bottom: 0px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #button2{
    left: 140px;
  }
  #button3{
    left: 280px;
  }
</style>


<body>
  <div class="loader" id="info">
    <button class="buttons" type="button" id="button1" onclick="button1event()">回答１</button>
    <button class="buttons" type="button" id="button2" onclick="button2event()">回答２</button>
    <button class="buttons" type="button" id="button3" onclick="button3event()">回答３</button>
  </div>
  <div class="start" id="quizstart">
    <div>クイズAR！</div>
    <button class="startbutton" type="button" id="quizstartbutton" onclick="quizstart()">クイズAR！スタート！</button>
  </div> 
  <a-scene
    vr-mode-ui="enabled: false;"
    renderer="logarithmicDepthBuffer: true;"
    embedded
    arjs="sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960;"
    
  >
  <a-assets>
    <audio src="./audio/Correct.mp3" id="correct"></audio>
  </a-assets>
  <a-assets>
    <audio src="./audio/Incorrect.mp3" id="incorrect"></audio>
  </a-assets>
  <a-marker preset="hiro" registerevents>
    <a-entity
        id="sphere"
        geometry="primitive: box; radius: 1"
        material="color: #cc0000"
        scale="1 0.05 2"
        position="-1 0 0"
        turn
      >
      </a-entity>
      <a-entity
        id="bluebox"
        geometry="primitive: box; radius: 1"
        material="color: blue"
        scale="1 0.05 2"
        position="0 1 0"
        turn
      >
    </a-entity>
      <a-entity
        id="redbox"
        geometry="primitive: box; radius: 1"
        material="color: red"
        scale="1 0.05 2"
        position="1 0 0"
        turn
      >
      </a-entity>
  </a-marker>
  <a-nft
      type="nft"
      url="https://fumitakamurakami.github.io/ARJS/1000en"
      smooth="true"
      smoothCount="10"
      smoothTolerance=".01"
      smoothThreshold="5"
      registerevents
    >

  </a-ntf> 
    
    <a-entity camera fov="10000"><a-entity
      id="cam"
      cursor="rayOrigin: mouse; fuse:false"
      material="color: black; shader: flat"
    >
    </a-entity>
  </a-scene>
</body>